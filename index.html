<!DOCTYPE html>
<html>
<head>
    <title>Confetti Overlay</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        html, body, #confetti-canvas { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: transparent; }
        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    <script>
        const { ipcRenderer } = require('electron')
        const canvas = document.getElementById('confetti-canvas')
        const myConfetti = confetti.create(canvas, { resize: true, useWorker: true })

        // Configurable options
        const defaultConfig = {
            bursts: 3,
            particleCount: 100,
            spread: 100,
            gravity: 0,
            // colors: ['#red', '#green', '#blue', '#yellow', '#orange', '#purple'],
            resize: true,
            shapes: ['circle', 'square']
        }

        var pumpkin = confetti.shapeFromPath({
            path: 'M449.4 142c-5 0-10 .3-15 1a183 183 0 0 0-66.9-19.1V87.5a17.5 17.5 0 1 0-35 0v36.4a183 183 0 0 0-67 19c-4.9-.6-9.9-1-14.8-1C170.3 142 105 219.6 105 315s65.3 173 145.7 173c5 0 10-.3 14.8-1a184.7 184.7 0 0 0 169 0c4.9.7 9.9 1 14.9 1 80.3 0 145.6-77.6 145.6-173s-65.3-173-145.7-173zm-220 138 27.4-40.4a11.6 11.6 0 0 1 16.4-2.7l54.7 40.3a11.3 11.3 0 0 1-7 20.3H239a11.3 11.3 0 0 1-9.6-17.5zM444 383.8l-43.7 17.5a17.7 17.7 0 0 1-13 0l-37.3-15-37.2 15a17.8 17.8 0 0 1-13 0L256 383.8a17.5 17.5 0 0 1 13-32.6l37.3 15 37.2-15c4.2-1.6 8.8-1.6 13 0l37.3 15 37.2-15a17.5 17.5 0 0 1 13 32.6zm17-86.3h-82a11.3 11.3 0 0 1-6.9-20.4l54.7-40.3a11.6 11.6 0 0 1 16.4 2.8l27.4 40.4a11.3 11.3 0 0 1-9.6 17.5z',
            matrix: [0.020491803278688523, 0, 0, 0.020491803278688523, -7.172131147540983, -5.9016393442622945]
        })
        var unicorn = confetti.shapeFromText({ text: 'ðŸ¦„' })
        // var lightning = confetti.shapeFromText({ text: 'âš¡' })
        var cloud = confetti.shapeFromText({ text: 'â›…' })
        var partyPopper = confetti.shapeFromText({ text: 'ðŸŽ‰' })

        function getRandom(min, max) {
            return min + Math.random() * (max - min)
        }

        const customShapes = {
            unicorn,
            pumpkin,
            // lightning
            // add more here
        }

        function launchConfetti(options) {
            for (let i = 0; i < options.bursts; i++) {
                setTimeout(() => {
                    myConfetti({
                        particleCount: options.particleCount,
                        spread: options.spread,
                        origin: options.origin || { x: Math.random(), y: Math.random() * 0.5 },
                        gravity: options.gravity,
                        shapes: options.shapes,
                        colors: options.colors,
                        decay: options.decay || .9,
                        scalar: options.scalar || 1.2,
                        flat: options.flat || false,
                        angle: options.angle || 90,
                        ticks: options.ticks || 200,
                    })
                }, i * 200)
            }
        }

        ipcRenderer.on('launch-confetti', (_, options) => {
            const confettiOptions = {...defaultConfig, ...options}
            if (Array.isArray(confettiOptions.shapes)) {
                confettiOptions.shapes = confettiOptions.shapes.map(s => {
                    if (customShapes[s]) {
                        return customShapes[s]
                    } else if (/^emoji:/.test(s)) {
                        // Example: "emoji:ðŸŽ‰"
                        const emoji = s.replace(/^emoji:/, '')
                        return confetti.shapeFromText({ text: emoji })
                    }
                    return s
                })
            }
            launchConfetti(confettiOptions)
        })
        ipcRenderer.on('confetti-fire', () => {
          launchConfetti(defaultConfig)
        })
    </script>
</body>
</html>
